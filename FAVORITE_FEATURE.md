# 收藏功能说明

## 功能概述

应用现已支持视频收藏功能和播放列表模式切换。用户可以收藏喜欢的视频，并在全局列表和收藏列表之间切换。

---

## 🎮 遥控器操作

### 基本操作
| 按键 | 功能 |
|------|------|
| ⬅️ 左键 | 切换到上一个视频（仅在当前列表内） |
| ➡️ 右键 | 切换到下一个视频（仅在当前列表内） |
| 🔙 返回键 | 退出应用 |

### 新增操作
| 按键 | 功能 |
|------|------|
| 🔘 确认键（长按） | 收藏/取消收藏当前视频 |
| 📋 菜单键 | 切换播放列表模式 |

---

## 📋 播放列表模式

### 全局列表模式
- **显示**：顶部左侧显示"全局列表"
- **功能**：播放所有视频（本地+远程）
- **切换**：按菜单键切换到收藏列表

### 收藏列表模式
- **显示**：顶部左侧显示"❤ 收藏列表"
- **功能**：仅播放已收藏的视频
- **切换**：按菜单键切换到全局列表
- **提示**：如果没有收藏任何视频，列表为空

---

## ❤️ 收藏功能

### 如何收藏视频
1. 播放要收藏的视频
2. **长按确认键**（约500ms）
3. 屏幕显示"已收藏: [视频标题]"提示

### 如何取消收藏
1. 播放已收藏的视频
2. **长按确认键**（约500ms）
3. 屏幕显示"已取消收藏: [视频标题]"提示

### 收藏状态显示
- **顶部右侧**：显示红色❤符号表示当前视频已收藏
- **无符号**：表示当前视频未收藏

---

## 📊 UI 显示

### 顶部状态栏
```
┌─────────────────────────────────────────┐
│ 全局列表/❤ 收藏列表    ❤ 2/5           │
└─────────────────────────────────────────┘
```

- **左侧**：当前播放列表模式
- **右侧**：
  - ❤ 符号（如果当前视频已收藏）
  - 当前视频位置/列表总数

### 底部视频标题
```
┌─────────────────────────────────────────┐
│ Big Buck Bunny                          │
└─────────────────────────────────────────┘
```

---

## 💾 数据存储

### 收藏数据
- **存储位置**：SharedPreferences
- **文件名**：`favorites`
- **格式**：JSON数组（视频ID列表）
- **持久化**：应用卸载前数据保留

### 收藏列表
- 自动保存所有收藏的视频ID
- 应用重启后自动恢复收藏列表
- 支持清除所有收藏（需要代码调用）

---

## 🔄 列表切换行为

### 切换到全局列表
1. 显示所有视频
2. 从第一个视频开始播放
3. 左右键在全局列表内切换

### 切换到收藏列表
1. 显示仅收藏的视频
2. 从第一个收藏视频开始播放
3. 左右键仅在收藏列表内切换
4. 如果没有收藏视频，显示空列表

### 列表内切换
- **左键**：切换到上一个视频（循环）
- **右键**：切换到下一个视频（循环）
- **范围**：仅在当前列表内切换

---

## 📱 使用场景

### 场景1：收藏喜欢的视频
```
1. 播放全局列表中的视频
2. 找到喜欢的视频
3. 长按确认键收藏
4. 重复步骤2-3收藏多个视频
```

### 场景2：只看收藏的视频
```
1. 按菜单键切换到收藏列表
2. 应用显示"切换到❤ 收藏列表 (共3个视频)"
3. 使用左右键在收藏视频间切换
```

### 场景3：从收藏列表返回全局列表
```
1. 在收藏列表中按菜单键
2. 应用显示"切换到全局列表 (共5个视频)"
3. 继续使用左右键切换
```

---

## 🛠️ 技术实现

### 新增类

#### FavoriteManager
- **位置**：`manager/FavoriteManager.kt`
- **功能**：管理收藏列表
- **方法**：
  - `toggleFavorite()` - 切换收藏状态
  - `addFavorite()` - 添加收藏
  - `removeFavorite()` - 移除收藏
  - `isFavorite()` - 检查是否收藏
  - `getFavoriteIds()` - 获取所有收藏ID

#### PlaylistMode
- **位置**：`manager/VideoManager.kt`
- **类型**：枚举
- **值**：
  - `ALL` - 全局列表
  - `FAVORITE` - 收藏列表

### 修改的类

#### VideoManager
- **新增方法**：
  - `toggleFavorite()` - 切换收藏
  - `isFavorite()` - 检查收藏
  - `switchPlaylistMode()` - 切换模式
  - `getPlaylistMode()` - 获取当前模式
  - `getPlaylistSize()` - 获取列表大小
  - `getCurrentIndex()` - 获取当前位置

- **修改方法**：
  - `getCurrentVideo()` - 支持列表模式
  - `getNextVideo()` - 支持列表模式
  - `getPreviousVideo()` - 支持列表模式

#### WallpaperControlActivity
- **新增方法**：
  - `toggleFavoriteVideo()` - 收藏当前视频
  - `switchPlaylistMode()` - 切换列表模式
  - `onKeyUp()` - 处理长按事件

- **修改方法**：
  - `onKeyDown()` - 添加菜单键和确认键处理

#### VideoPlayScreen
- **新增UI**：
  - 顶部状态栏（模式和收藏状态）
  - 底部视频标题
  - 收藏状态指示器

---

## 🔍 调试信息

### Logcat 输出
```
// 收藏视频
D/VideoPlayActivity: 已收藏: Big Buck Bunny

// 取消收藏
D/VideoPlayActivity: 已取消收藏: Big Buck Bunny

// 切换模式
D/VideoManager: Switched to playlist mode: FAVORITE

// 列表切换
D/VideoManager: Switched to next video in FAVORITE mode: Elephants Dream
```

---

## ⚙️ 配置选项

### 长按时间
- **位置**：`WallpaperControlActivity.kt`
- **变量**：`LONG_PRESS_DURATION`
- **默认值**：500ms
- **修改**：可根据需要调整

```kotlin
private val LONG_PRESS_DURATION = 500L // 修改此值
```

---

## 🐛 已知限制

1. **收藏列表为空**：切换到收藏列表时，如果没有收藏任何视频，列表为空
2. **长按检测**：长按时间基于按键事件，可能因设备而异
3. **UI更新**：UI状态可能需要手动刷新（目前使用LaunchedEffect）

---

## 🚀 未来改进

- [ ] 添加收藏列表管理界面
- [ ] 支持批量收藏/取消收藏
- [ ] 添加收藏排序功能
- [ ] 支持收藏分类
- [ ] 添加收藏导出/导入功能
- [ ] 支持收藏同步到云端

---

## 📝 使用示例

### 代码示例

```kotlin
// 收藏视频
val isFavorite = videoManager.toggleFavorite(video)

// 检查是否收藏
if (videoManager.isFavorite(video)) {
    // 已收藏
}

// 切换列表模式
val newMode = videoManager.switchPlaylistMode()

// 获取当前列表大小
val size = videoManager.getPlaylistSize()

// 获取收藏数量
val favoriteCount = videoManager.getFavoriteCount()
```

---

## 📞 常见问题

### Q: 如何清除所有收藏？
**A:** 目前需要通过代码调用 `favoriteManager.clearAllFavorites()`

### Q: 收藏数据会丢失吗？
**A:** 不会。收藏数据保存在SharedPreferences中，应用卸载前数据保留

### Q: 如何导出收藏列表？
**A:** 目前不支持导出，可以通过代码访问 `favoriteManager.getFavoriteIds()`

### Q: 长按时间太短/太长？
**A:** 可以修改 `LONG_PRESS_DURATION` 常量调整

### Q: 收藏列表为空时会怎样？
**A:** 切换到收藏列表时，如果没有收藏任何视频，应用会显示空列表

---

**功能完成日期：** 2024年12月14日  
**版本：** 2.1 (收藏功能版)
